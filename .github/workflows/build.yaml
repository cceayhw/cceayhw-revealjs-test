---
name: build reveal js
on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      # Give the default GITHUB_TOKEN write permission to commit and push the
      # added or changed files to the repository.
      contents: write
      pages: write
      id-token: write

    steps:
      - uses: actions/checkout@v6
        with:
          ref: ${{ github.head_ref }}
          # Value already defaults to true, but `persist-credentials` is required to push new commits to the repository.
          persist-credentials: true

      - uses: actions/checkout@v6
        with:
          repository: hakimel/reveal.js
          ref: master
          path: docs
      - name: debug
        run: |
          ls -lR
      - name: generate revealjs using pandoc
        uses: docker://pandoc/core:latest
        with:
          args: >-
            --from=gfm
            --to=revealjs
            --self-contained
            --standalone
            --output=docs/index.html
            -V revealjs-url=https://unpkg.com/reveal.js
            show-n-tell.md
      - name: debug
        run: |
          ls -lR
      - name: Setup Pages
        uses: actions/configure-pages@v5
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'docs/'
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: 'docs/index.html'
          push_options: --force
